import { Color } from './color.class';
import { Subject, BehaviorSubject } from 'rxjs';
import { distinctUntilChanged } from 'rxjs/operators';
import { Rgba } from './rgba.class';
export var ColorType;
(function (ColorType) {
    ColorType["hex"] = "hex";
    ColorType["hexa"] = "hexa";
    ColorType["rgba"] = "rgba";
    ColorType["rgb"] = "rgb";
    ColorType["hsla"] = "hsla";
    ColorType["hsl"] = "hsl";
    ColorType["cmyk"] = "cmyk";
})(ColorType || (ColorType = {}));
export class ColorPickerControl {
    constructor() {
        this.modelValue = null;
        this.hueValue = null;
        this.initValue = null;
        this.valueChanged = new Subject();
        this.presetsVisibilityChanges = new BehaviorSubject(true);
        this.initType = null;
        this.alphaChannelVisibilityChanges = new BehaviorSubject(true);
        this.valueChanges = this.valueChanged.asObservable().pipe(distinctUntilChanged((x, y) => x.toRgbaString() == y.toRgbaString()));
        this.colorPresets = [];
        const color = Color.from(new Rgba(255, 0, 0, 1));
        this.setValue(color);
        this.setHueColor(color);
    }
    setValueFrom(color) {
        const newColor = Color.from(color);
        if (!this.initValue) {
            this.initValue = Color.from(color);
        }
        if (typeof color === 'string') {
            this.finOutInputType(color);
        }
        this.setHueColor(newColor);
        this.setValue(newColor);
        return this;
    }
    setHueColor(color) {
        this.hueValue = new Color().setHsva(color.getHsva().hue);
    }
    get hue() {
        return this.hueValue;
    }
    /**
     * @internal
     * used for two-way data binding
     */
    set hue(hueColor) {
        this.hueValue = hueColor;
    }
    setValue(value) {
        this.modelValue = value;
        this.valueChanged.next(value);
        return this;
    }
    get value() {
        return this.modelValue;
    }
    /**
     * @internal
     * used for two-way data binding
     */
    set value(value) {
        this.setValue(value);
    }
    /**
     * reset color to initial
     */
    reset() {
        let color;
        if (!this.initValue) {
            color = Color.from(new Rgba(255, 0, 0, 1));
            this.hueValue = new Color().setHsva(color.getHsva().hue);
        }
        else {
            color = this.initValue.clone();
            this.setHueColor(color);
        }
        this.setValue(color);
        return this;
    }
    isAlphaChannelEnabled() {
        return this.alphaChannelVisibilityChanges.value;
    }
    showAlphaChannel() {
        this.alphaChannelVisibilityChanges.next(true);
        return this;
    }
    hideAlphaChannel() {
        this.alphaChannelVisibilityChanges.next(false);
        return this;
    }
    finOutInputType(colorString) {
        const str = colorString.replace(/ /g, '').toLowerCase();
        if (str[0] === '#') {
            this.initType = ColorType.hex;
            if (str.length > 7) {
                this.initType = ColorType.hexa;
            }
        }
        const OpenParenthesis = str.indexOf('(');
        const colorTypeName = str.substr(0, OpenParenthesis);
        switch (colorTypeName) {
            case ColorType.rgba:
                this.initType = ColorType.rgba;
                break;
            case ColorType.rgb:
                this.initType = ColorType.rgb;
                break;
            case ColorType.hsla:
                this.initType = ColorType.hsla;
                break;
            case ColorType.hsl:
                this.initType = ColorType.hsl;
                break;
            case ColorType.cmyk:
                this.initType = ColorType.cmyk;
                break;
        }
    }
    setColorPresets(colorPresets) {
        this.colorPresets = this.setPresets(colorPresets);
        return this;
    }
    setPresets(colorPresets) {
        const presets = [];
        for (const color of colorPresets) {
            if (Array.isArray(color)) {
                presets.push(this.setPresets(color));
            }
            else {
                presets.push(new Color(color));
            }
        }
        return presets;
    }
    get presets() {
        return this.colorPresets;
    }
    hasPresets() {
        return this.colorPresets.length > 0;
    }
    isPresetVisible() {
        return this.presetsVisibilityChanges.value;
    }
    showPresets() {
        this.presetsVisibilityChanges.next(true);
        return this;
    }
    hidePresets() {
        this.presetsVisibilityChanges.next(false);
        return this;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbC5jbGFzcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2lwbGFiL25neC1jb2xvci1waWNrZXIvc3JjL2xpYi9oZWxwZXJzL2NvbnRyb2wuY2xhc3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLEtBQUssRUFBZSxNQUFNLGVBQWUsQ0FBQztBQUNuRCxPQUFPLEVBQUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNoRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN0RCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBSXBDLE1BQU0sQ0FBTixJQUFZLFNBUVg7QUFSRCxXQUFZLFNBQVM7SUFDakIsd0JBQVcsQ0FBQTtJQUNYLDBCQUFhLENBQUE7SUFDYiwwQkFBYSxDQUFBO0lBQ2Isd0JBQVcsQ0FBQTtJQUNYLDBCQUFhLENBQUE7SUFDYix3QkFBVyxDQUFBO0lBQ1gsMEJBQWEsQ0FBQTtBQUNqQixDQUFDLEVBUlcsU0FBUyxLQUFULFNBQVMsUUFRcEI7QUFFRCxNQUFNLE9BQU8sa0JBQWtCO0lBYzNCO1FBWlEsZUFBVSxHQUFVLElBQUksQ0FBQztRQUN6QixhQUFRLEdBQVUsSUFBSSxDQUFDO1FBQ3ZCLGNBQVMsR0FBVSxJQUFJLENBQUM7UUFDZixpQkFBWSxHQUFtQixJQUFJLE9BQU8sRUFBRSxDQUFDO1FBRTlDLDZCQUF3QixHQUE2QixJQUFJLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4RixhQUFRLEdBQWMsSUFBSSxDQUFDO1FBQ2xCLGtDQUE2QixHQUE2QixJQUFJLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNwRixpQkFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxFQUFFLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMs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Q0FBQztJQUNoQixDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb2xvciwgQ29sb3JTdHJpbmcgfSBmcm9tICcuL2NvbG9yLmNsYXNzJztcclxuaW1wb3J0IHsgU3ViamVjdCwgQmVoYXZpb3JTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBSZ2JhIH0gZnJvbSAnLi9yZ2JhLmNsYXNzJztcclxuaW1wb3J0IHsgSHNsYSB9IGZyb20gJy4vaHNsYS5jbGFzcyc7XHJcbmltcG9ydCB7IEhzdmEgfSBmcm9tICcuL2hzdmEuY2xhc3MnO1xyXG5cclxuZXhwb3J0IGVudW0gQ29sb3JUeXBlIHtcclxuICAgIGhleCA9ICdoZXgnLFxyXG4gICAgaGV4YSA9ICdoZXhhJyxcclxuICAgIHJnYmEgPSAncmdiYScsXHJcbiAgICByZ2IgPSAncmdiJyxcclxuICAgIGhzbGEgPSAnaHNsYScsXHJcbiAgICBoc2wgPSAnaHNsJyxcclxuICAgIGNteWsgPSAnY215aydcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIENvbG9yUGlja2VyQ29udHJvbCB7XHJcblxyXG4gICAgcHJpdmF0ZSBtb2RlbFZhbHVlOiBDb2xvciA9IG51bGw7XHJcbiAgICBwcml2YXRlIGh1ZVZhbHVlOiBDb2xvciA9IG51bGw7XHJcbiAgICBwcml2YXRlIGluaXRWYWx1ZTogQ29sb3IgPSBudWxsO1xyXG4gICAgcHJpdmF0ZSByZWFkb25seSB2YWx1ZUNoYW5nZWQ6IFN1YmplY3Q8Q29sb3I+ID0gbmV3IFN1YmplY3QoKTtcclxuXHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgcHJlc2V0c1Zpc2liaWxpdHlDaGFuZ2VzOiBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0KHRydWUpO1xyXG4gICAgcHVibGljIGluaXRUeXBlOiBDb2xvclR5cGUgPSBudWxsO1xyXG4gICAgcHVibGljIHJlYWRvbmx5IGFscGhhQ2hhbm5lbFZpc2liaWxpdHlDaGFuZ2VzOiBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0KHRydWUpO1xyXG4gICAgcHVibGljIHJlYWRvbmx5IHZhbHVlQ2hhbmdlcyA9IHRoaXMudmFsdWVDaGFuZ2VkLmFzT2JzZXJ2YWJsZSgpLnBpcGUoZGlzdGluY3RVbnRpbENoYW5nZWQoKHgsIHkpID0+IHgudG9SZ2JhU3RyaW5nKCkgPT0geS50b1JnYmFTdHJpbmcoKSkpO1xyXG5cclxuICAgIHByaXZhdGUgY29sb3JQcmVzZXRzOiBBcnJheTxBcnJheTxDb2xvcj4gfCBDb2xvcj4gPSBbXTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBjb25zdCBjb2xvciA9IENvbG9yLmZyb20obmV3IFJnYmEoMjU1LCAwLCAwLCAxKSk7XHJcbiAgICAgICAgdGhpcy5zZXRWYWx1ZShjb2xvcik7XHJcbiAgICAgICAgdGhpcy5zZXRIdWVDb2xvcihjb2xvcik7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldFZhbHVlRnJvbShjb2xvcjogQ29sb3JTdHJpbmcgfCBDb2xvciB8IFJnYmEgfCBIc2xhIHwgSHN2YSk6IHRoaXMge1xyXG4gICAgICAgIGNvbnN0IG5ld0NvbG9yID0gQ29sb3IuZnJvbShjb2xvcik7XHJcbiAgICAgICAgaWYgKCF0aGlzLmluaXRWYWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLmluaXRWYWx1ZSA9IENvbG9yLmZyb20oY29sb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiBjb2xvciA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgdGhpcy5maW5PdXRJbnB1dFR5cGUoY29sb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNldEh1ZUNvbG9yKG5ld0NvbG9yKTtcclxuICAgICAgICB0aGlzLnNldFZhbHVlKG5ld0NvbG9yKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldEh1ZUNvbG9yKGNvbG9yOiBDb2xvcikge1xyXG4gICAgICAgIHRoaXMuaHVlVmFsdWUgPSBuZXcgQ29sb3IoKS5zZXRIc3ZhKGNvbG9yLmdldEhzdmEoKS5odWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXQgaHVlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmh1ZVZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGludGVybmFsXHJcbiAgICAgKiB1c2VkIGZvciB0d28td2F5IGRhdGEgYmluZGluZ1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2V0IGh1ZShodWVDb2xvcjogQ29sb3IpIHtcclxuICAgICAgICB0aGlzLmh1ZVZhbHVlID0gaHVlQ29sb3I7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRWYWx1ZSh2YWx1ZTogQ29sb3IpOiB0aGlzIHtcclxuICAgICAgICB0aGlzLm1vZGVsVmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlZC5uZXh0KHZhbHVlKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0IHZhbHVlKCk6IENvbG9yIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5tb2RlbFZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQGludGVybmFsXHJcbiAgICAgKiB1c2VkIGZvciB0d28td2F5IGRhdGEgYmluZGluZ1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2V0IHZhbHVlKHZhbHVlOiBDb2xvcikge1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWUodmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogcmVzZXQgY29sb3IgdG8gaW5pdGlhbFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgcmVzZXQoKTogdGhpcyB7XHJcbiAgICAgICAgbGV0IGNvbG9yO1xyXG4gICAgICAgIGlmICghdGhpcy5pbml0VmFsdWUpIHtcclxuICAgICAgICAgICAgY29sb3IgPSBDb2xvci5mcm9tKG5ldyBSZ2JhKDI1NSwgMCwgMCwgMSkpO1xyXG4gICAgICAgICAgICB0aGlzLmh1ZVZhbHVlID0gbmV3IENvbG9yKCkuc2V0SHN2YShjb2xvci5nZXRIc3ZhKCkuaHVlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb2xvciA9IHRoaXMuaW5pdFZhbHVlLmNsb25lKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0SHVlQ29sb3IoY29sb3IpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5zZXRWYWx1ZShjb2xvcik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGlzQWxwaGFDaGFubmVsRW5hYmxlZCgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5hbHBoYUNoYW5uZWxWaXNpYmlsaXR5Q2hhbmdlcy52YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2hvd0FscGhhQ2hhbm5lbCgpOiB0aGlzIHtcclxuICAgICAgICB0aGlzLmFscGhhQ2hhbm5lbFZpc2liaWxpdHlDaGFuZ2VzLm5leHQodHJ1ZSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGhpZGVBbHBoYUNoYW5uZWwoKTogdGhpcyB7XHJcbiAgICAgICAgdGhpcy5hbHBoYUNoYW5uZWxWaXNpYmlsaXR5Q2hhbmdlcy5uZXh0KGZhbHNlKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGZpbk91dElucHV0VHlwZShjb2xvclN0cmluZzogQ29sb3JTdHJpbmcpIHtcclxuICAgICAgICBjb25zdCBzdHIgPSBjb2xvclN0cmluZy5yZXBsYWNlKC8gL2csICcnKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIGlmIChzdHJbMF0gPT09ICcjJykge1xyXG4gICAgICAgICAgICB0aGlzLmluaXRUeXBlID0gQ29sb3JUeXBlLmhleDtcclxuICAgICAgICAgICAgaWYgKHN0ci5sZW5ndGggPiA3KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRUeXBlID0gQ29sb3JUeXBlLmhleGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IE9wZW5QYXJlbnRoZXNpcyA9IHN0ci5pbmRleE9mKCcoJyk7XHJcbiAgICAgICAgY29uc3QgY29sb3JUeXBlTmFtZSA9IHN0ci5zdWJzdHIoMCwgT3BlblBhcmVudGhlc2lzKTtcclxuICAgICAgICBzd2l0Y2ggKGNvbG9yVHlwZU5hbWUpIHtcclxuICAgICAgICAgICAgY2FzZSBDb2xvclR5cGUucmdiYTpcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5pdFR5cGUgPSBDb2xvclR5cGUucmdiYTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIENvbG9yVHlwZS5yZ2I6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRUeXBlID0gQ29sb3JUeXBlLnJnYjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIENvbG9yVHlwZS5oc2xhOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbml0VHlwZSA9IENvbG9yVHlwZS5oc2xhO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQ29sb3JUeXBlLmhzbDpcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5pdFR5cGUgPSBDb2xvclR5cGUuaHNsO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgQ29sb3JUeXBlLmNteWs6XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRUeXBlID0gQ29sb3JUeXBlLmNteWs7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldENvbG9yUHJlc2V0cyhjb2xvclByZXNldHM6IEFycmF5PEFycmF5PENvbG9yU3RyaW5nPiB8IENvbG9yU3RyaW5nPik6IHRoaXMge1xyXG4gICAgICAgIHRoaXMuY29sb3JQcmVzZXRzID0gdGhpcy5zZXRQcmVzZXRzKGNvbG9yUHJlc2V0cyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRQcmVzZXRzKGNvbG9yUHJlc2V0czogQXJyYXk8QXJyYXk8Q29sb3JTdHJpbmc+IHwgQ29sb3JTdHJpbmc+KTogQXJyYXk8Q29sb3I+IHtcclxuICAgICAgICBjb25zdCBwcmVzZXRzID0gW107XHJcblxyXG4gICAgICAgIGZvciAoY29uc3QgY29sb3Igb2YgY29sb3JQcmVzZXRzKSB7XHJcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvbG9yKSkge1xyXG4gICAgICAgICAgICAgICAgcHJlc2V0cy5wdXNoKHRoaXMuc2V0UHJlc2V0cyhjb2xvcikpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcHJlc2V0cy5wdXNoKG5ldyBDb2xvcihjb2xvcikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwcmVzZXRzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXQgcHJlc2V0cygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb2xvclByZXNldHM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGhhc1ByZXNldHMoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29sb3JQcmVzZXRzLmxlbmd0aCA+IDA7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGlzUHJlc2V0VmlzaWJsZSgpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wcmVzZXRzVmlzaWJpbGl0eUNoYW5nZXMudmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNob3dQcmVzZXRzKCk6IHRoaXMge1xyXG4gICAgICAgIHRoaXMucHJlc2V0c1Zpc2liaWxpdHlDaGFuZ2VzLm5leHQodHJ1ZSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGhpZGVQcmVzZXRzKCk6IHRoaXMge1xyXG4gICAgICAgIHRoaXMucHJlc2V0c1Zpc2liaWxpdHlDaGFuZ2VzLm5leHQoZmFsc2UpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==